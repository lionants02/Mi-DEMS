{
  "openapi": "3.0.2",
  "info": {
    "title": "Mi-DEMS openapi doc",
    "version": "DRAF_V1_07-06-2024",
    "description": "api สำหรับให้ภายนอกเชื่อมต่อกับระบบ Mi-DEMS โดยการออกแบบปัจจุบัน จะอ้างอิงพาหนะผูกกับห้องประชุมแบบ หนึ่ง ต่อ หนึ่ง <br> [เอกสารอ้างอิง](https://github.com/lionants02/Mi-DEMS/blob/page/README.md)"
  },
  "servers": [
    {
      "url": "{base_url}",
      "description": "ปรับแต่ง url ได้เอง",
      "variables": {
        "base_url": {
          "default": "http://localhost:8080/v1"
        }
      }
    },
    {
      "url": "http://localhost:8080/v1",
      "description": "สำหรับทดสอบ"
    },
    {
      "url": "/",
      "description": "ใช้ root url จากลิงก์ปัจจุบันที่เปิดเอกสาร"
    }
  ],
  "security": [
    {
      "Authorization": []
    }
  ],
  "components": {
    "securitySchemes": {
      "Authorization": {
        "type": "apiKey",
        "name": "Authorization",
        "in": "header",
        "description": "ปรับแต่งรูปแบบ Key ภายใต้ Authorization http header ใต้ตามต้องการ <br> Example Bearer xxxxx <br> Example api-key aabbcc"
      }
    },
    "schemas": {
      "gps": {
        "type": "object",
        "description": "ข้อมูลเกี่ยวกับตำแหน่งพิกัด GPS",
        "properties": {
          "lat": {
            "type": "number",
            "description": "พิกัดละติจูด",
            "example": 14.077885847295322
          },
          "lng": {
            "type": "number",
            "description": "พิกัดลองติจูด",
            "example": 100.60228228571454
          },
          "accuracy": {
            "type": "number",
            "description": "ค่าความแม่นยำ +- หน่วยเป็น เมตร",
            "example": 10
          }
        }
      },
      "configRoom": {
        "type": "object",
        "description": "ชุดข้อมูลสั่งเปิดเคส ไปยังชุดรถที่ต้องการ",
        "required": ["patients", "operation_set"],
        "properties": {
          "patients": {
            "type": "array",
            "description": "รายการผู้ป่วย",
            "items": {
              "$ref": "#/components/schemas/patients"
            }
          },
          "operation_set": {
            "$ref": "#/components/schemas/operation_set"
          }
        }
      },
      "operation_set": {
        "type": "object",
        "required": ["id", "level"],
        "properties": {
          "id": {
            "type": "string",
            "description": "รหัสชุด",
            "example": "50-1-VZZ-107"
          },
          "level": {
            "type": "string",
            "description": "ระดับของชุด",
            "example": "ALS"
          },
          "mapWebView": {
            "type": "string",
            "description": "ดูพิกัด GPS แบบ webView"
          },
          "GeoJSONApi": {
            "type": "string",
            "description": "ข้อมูลเพื่อดึงข้อมูลตำแหน่งในรูปแบบ GeoJSON"
          },
          "createAt": {
            "type": "string",
            "description": "สร้างข้อมูลเมื่อ ไม่ต้องส่งค่านี้เข้ามา จะถูกสร้างโดยระบบ",
            "example": "2023-03-10T22:08:51.718584300"
          }
        }
      },
      "patients": {
        "type": "object",
        "required": ["patientId", "caseId", "idc_level"],
        "properties": {
          "patientId": {
            "type": "string",
            "description": "รหัสผู้ป่วย",
            "example": "P6601-1001-0011"
          },
          "caseId": {
            "type": "string",
            "description": "รหัสรับแจ้ง",
            "example": "cse-5651"
          },
          "idc_level": {
            "type": "string",
            "description": "รหัสความรุ่นแรง ตามตาราง icd_level Master",
            "example": "2"
          }
        }
      },
      "conferenceRoom": {
        "type": "object",
        "description": "ข้อมูลห้องประชุมฉุกเฉิน",
        "properties": {
          "roomId": {
            "type": "string",
            "description": "รหัส id ของห้องประชุมในการสร้งแต่ละครั้ง รหัสนี้จะไม่ซ้ำกัน",
            "example": "c11235"
          },
          "link": {
            "type": "string",
            "description": "ลิงก์หน้าเว็บห้องประชุมเฉุกเฉิน",
            "example": "https://mi-dems-con/c11235"
          },
          "createAt": {
            "type": "string",
            "description": "สร้างข้อมูลเมื่อ ไม่ต้องส่งค่านี้เข้ามา จะถูกสร้างโดยระบบ",
            "example": "2023-03-10T22:08:51.718584300"
          },
          "configRoom": {
            "description": "ข้อมูลการตั้งค่าห้องประชุม",
            "$ref": "#/components/schemas/configRoom"
          }
        }
      },
      "ClosingReasonCode": {
        "type": "string",
        "description": "รหัสเหตุผลปิดงาน 1=ส่งต่อชุดระดับสูงกว่า, 2=ไม่นำส่งอาจจะขอลงระหว่างทาง, 3=เสียชีวิตระหว่างนำส่ง, 4=เสียชีวิต ณ จุดเกิดเหตุ, 5=ผู้ป่วยปฏิเสทการรักษาไม่ไป รพ., 6=ยกเลิกโดยศูนย์หรือบังคับยกเลิก, 7=ไม่พบเหตุ, 8=เสียชีวิตก่อนชุดไปถึง",
        "default": "2",
        "enum": ["1", "2", "3", "4", "5", "6", "7", "8"]
      },
      "stampCode": {
        "type": "string",
        "example": "3",
        "description": "1=รับงาน, 2=ออกจากฐาน, 3=ถึงจุดเกิดเหตุ/จุดรับผู้ป่วย, 4=มีการรักษา, 5=ออกจากจุดเกิดเหตุ, 6=ถึงโรงพยาบาล, 7=กลับถึงฐาน/พร้อมรับงานต่อ"
      }
    },
    "responses": {
      "notFound404": {
        "description": "ไม่พบข้อมูล",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 404 code",
                  "type": "string",
                  "example": "404"
                },
                "Message": {
                  "description": "ข้อความสถานะ Not Found",
                  "type": "string",
                  "example": "ไม่พบข้อมูล......"
                }
              }
            }
          }
        }
      },
      "noAuth401": {
        "description": "token ไม่มีสิทธิ์ใช้งานระบบ",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 401 code",
                  "type": "string",
                  "example": "401"
                },
                "Message": {
                  "description": "ข้อความสถานะ Unauthorized",
                  "type": "string",
                  "example": "Unauthorized ......"
                }
              }
            }
          }
        }
      },
      "bad400": {
        "description": "Bad Request เกิดจากพารามิเตอร์บางตัวมีปัญหา",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 400 code",
                  "type": "string",
                  "example": "400"
                },
                "Message": {
                  "description": "ข้อความสถานะ Bad Request",
                  "type": "string",
                  "example": "Bad Request .....ไม่พบ...ค่าเกิน...."
                }
              }
            }
          }
        }
      }
    }
  },
  "paths": {
    "/room/{operation_set_id}": {
      "post": {
        "tags": ["ห้องประชุม"],
        "summary": "สร้างห้องประชุม Mi-DEMS",
        "description": "สร้างห้องประชุมในระบบ Mi-DEMS โดยระบบจะส่งการแจ้งเตือนรับงานฉุกเฉินไปยังทุกคนในชุดที่ระบุ",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "50-1-VZZ-107"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/configRoom"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "ส่งคืนข้อมูลห้องประชุม",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/conferenceRoom"
                }
              }
            }
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "Bad request ดู message",
            "$ref": "#/components/responses/bad400"
          }
        }
      },
      "delete": {
        "tags": ["ห้องประชุม"],
        "summary": "ปิดห้องประชุม Mi-DEMS ก่อนถึง รพ.",
        "description": "ปิดห้องประชุมในระบบ Mi-DEMS ก่อนถึงโรงพยาบาล โดยระบบจะปิดห้องของชุดปฏิบัติการ และ นำผู้ป่วยที่อยู่ในการดูแลของชุดนี้ออก และพร้อมสำหรับสร้างห้องใหม่ต่อไป",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "50-1-VZZ-107"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["closingReasonCode"],
                "properties": {
                  "closingReasonCode": {
                    "$ref": "#/components/schemas/ClosingReasonCode"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ปิดห้องสมบูรณ์"
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "ไม่พบรหัส ClosingReasonCode ที่ระบุ",
            "$ref": "#/components/responses/bad400"
          }
        }
      }
    },
    "/room/{operation_set_id}/stamp": {
      "post": {
        "tags": ["ห้องประชุม", "ผู้ป่วย"],
        "summary": "สแตมป์สถานะผู้ป่วย",
        "description": "จะสแตป์มสถานะของผู้ป่วยฉุกเฉิน ในห้องของชุดทีมปฏิบัติการที่กำลังปฏิบัติงาน",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "50-1-VZZ-107"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "ข้อมูลสแตมป์สถานะผู้ป่วยที่ชุดปฏิบัติการดูแลอยู่",
                "required": ["stampCode"],
                "properties": {
                  "stampCode": {
                    "$ref": "#/components/schemas/stampCode"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "สแตมป์สถานะสำเร็จ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "description": "รายการสแสมป์",
                  "items": {
                    "properties": {
                      "stampCode": {
                        "$ref": "#/components/schemas/stampCode"
                      },
                      "createAt": {
                        "type": "string",
                        "description": "วันเวลาที่ สแตมป์สถานะ",
                        "example": "2023-03-10T22:08:51.718584300"
                      }
                    }
                  }
                },
                "example": [
                  {
                    "stampCode": "2",
                    "createAt": "2023-03-10T22:01:10.718584300"
                  },
                  {
                    "stampCode": "3",
                    "createAt": "2023-03-10T22:08:51.718584300"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "ไม่พบรหัส stampCode หรือ อื่นๆ ดู message",
            "$ref": "#/components/responses/bad400"
          }
        }
      }
    },
    "/room/{operation_set_id}/patient": {
      "post": {
        "tags": ["ห้องประชุม", "ผู้ป่วย"],
        "summary": "เพิ่มผู้ป่วยในห้อง",
        "description": "ใช้ในกรณี มีผู้ป่วยเพิ่มหลังจากสร้างห้องไปแล้ว",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "50-1-VZZ-107"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/patients"
                }
              },
              "example": [
                {
                  "patientId": "P6601-1001-0016",
                  "caseId": "cse-5655",
                  "idc_level": "1"
                },
                {
                  "patientId": "P6601-1001-0099",
                  "caseId": "cse-5699",
                  "idc_level": "3"
                }
              ]
            }
          }
        },
        "responses": {
          "201": {
            "description": "เพิ่มผู้ป่วยสำเร็จ ส่งคืนข้อมูลห้องประชุม",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/conferenceRoom"
                },
                "example": {
                  "roomId": "c11235",
                  "link": "https://mi-dems-con/c11235",
                  "createAt": "2023-03-10T22:08:51.718584300",
                  "detail": {
                    "case": {
                      "patients": [
                        {
                          "patientId": "P6601-1001-0011",
                          "caseId": "cse-5651",
                          "idc_level": "2"
                        },
                        {
                          "patientId": "P6601-1001-0016",
                          "caseId": "cse-5655",
                          "idc_level": "1"
                        },
                        {
                          "patientId": "P6601-1001-0099",
                          "caseId": "cse-5699",
                          "idc_level": "3"
                        }
                      ],
                      "operation_set": {
                        "id": "50-1-VZZ-107",
                        "level": "ALS",
                        "mapWebView": "string",
                        "GeoJSONApi": "string",
                        "createAt": "2023-03-10T22:08:51.718584300"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "ไม่พบรหัส ClosingReasonCode ที่ระบุ",
            "$ref": "#/components/responses/bad400"
          }
        }
      }
    },
    "/patient/{patientId}": {
      "get": {
        "tags": ["ผู้ป่วย"],
        "summary": "ข้อมูลผู้ป่วย",
        "description": "ดูข้อมูลที่มีการเชื่อมโยงกับเคส เช่น ข้อมูลชุดที่รับพวกลิงก์ข้อมูลต่างๆ",
        "parameters": [
          {
            "name": "patientId",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "P6601-1001-0011"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "ข้อมูลของผู้ป่วย",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "operation": {
                      "type": "array",
                      "description": "ข้อมูลเกี่ยวกับชุดปฏิบัติการ",
                      "items": {
                        "type": "object",
                        "properties": {
                          "roomId": {
                            "type": "string",
                            "description": "เลขห้อง Mi-DEMS",
                            "example": "c11235"
                          },
                          "operation_set": {
                            "$ref": "#/components/schemas/operation_set"
                          }
                        }
                      }
                    },
                    "report": {
                      "type": "array",
                      "description": "ข้อมูล meta ของตัวรายงาน",
                      "items": {
                        "type": "object",
                        "properties": {
                          "reportId": {
                            "type": "string",
                            "description": "รหัสอ้างอิงจากตารางรายงาน",
                            "example": "r001"
                          },
                          "hospitalId": {
                            "type": "string",
                            "description": "รหัสสถานพยาบาลปลายทาง",
                            "example": "12345"
                          },
                          "operation_set_id": {
                            "type": "string",
                            "description": "รหัสชุด",
                            "example": "50-1-VZZ-107"
                          }
                        }
                      }
                    }
                  }
                },
                "example": {
                  "operation": [
                    {
                      "roomId": "c11235",
                      "operation_set": {
                        "id": "50-1-VZZ-107",
                        "level": "ALS",
                        "mapWebView": "string",
                        "GeoJSONApi": "string",
                        "createAt": "2023-03-10T22:08:51.718584300"
                      }
                    },
                    {
                      "roomId": "c11238",
                      "operation_set": {
                        "id": "50-1-VZZ-999",
                        "level": "ALS",
                        "mapWebView": "string",
                        "GeoJSONApi": "string",
                        "createAt": "2023-03-10T22:30:55.123584300"
                      }
                    }
                  ],
                  "report": [
                    {
                      "reportId": "r001",
                      "hospitalId": "12345",
                      "operation_set_id": "50-1-VZZ-107"
                    },
                    {
                      "reportId": "r005",
                      "hospitalId": "12345",
                      "operation_set_id": "50-1-VZZ-999"
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส patientId",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "ดู error message",
            "$ref": "#/components/responses/bad400"
          }
        }
      }
    }
  }
}
