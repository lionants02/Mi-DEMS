{
  "openapi": "3.0.2",
  "info": {
    "title": "Mi-DEMS openapi doc",
    "version": "DRAF_V1_07-06-2024",
    "description": "api สำหรับให้ภายนอกเชื่อมต่อกับระบบ Mi-DEMS"
  },
  "servers": [
    {
      "url": "{base_url}",
      "description": "ปรับแต่ง url ได้เอง",
      "variables": {
        "base_url": {
          "default": "http://localhost:8080/v1"
        }
      }
    },
    {
      "url": "http://localhost:8080/v1",
      "description": "สำหรับทดสอบ"
    }
  ],
  "security": [
    {
      "Authorization": []
    }
  ],
  "components": {
    "securitySchemes": {
      "Authorization": {
        "type": "apiKey",
        "name": "Authorization",
        "in": "header",
        "description": "ปรับแต่งรูปแบบ Key ภายใต้ Authorization http header ใต้ตามต้องการ <br> Example Bearer xxxxx <br> Example api-key aabbcc"
      }
    },
    "schemas": {
      "gps": {
        "type": "object",
        "description": "ข้อมูลเกี่ยวกับตำแหน่งพิกัด GPS",
        "properties": {
          "lat": {
            "type": "number",
            "description": "พิกัดละติจูด",
            "example": 14.077885847295322
          },
          "lng": {
            "type": "number",
            "description": "พิกัดลองติจูด",
            "example": 100.60228228571454
          },
          "accuracy": {
            "type": "number",
            "description": "ค่าความแม่นยำ +- หน่วยเป็น เมตร",
            "example": 10
          }
        }
      },
      "configRoom": {
        "type": "object",
        "description": "ชุดข้อมูลสั่งเปิดเคส ไปยังชุดรถที่ต้องการ",
        "properties": {
          "patient": {
            "type": "array",
            "description": "รายการผู้ป่วย",
            "items": {
              "type": "object",
              "properties": {
                "patientId": {
                  "type": "string",
                  "description": "รหัสผู้ป่วย",
                  "example": "p12235"
                },
                "caseId": {
                  "type": "string",
                  "description": "รหัสรับแจ้ง",
                  "example": "cse-5651"
                },
                "idc_level": {
                  "type": "string",
                  "description": "รหัสความรุ่นแรง ตามตาราง icd_level Master",
                  "example": "2"
                }
              }
            }
          },
          "operation_set_level": {
            "type": "string",
            "description": "ระดับของชุด",
            "example": "ALS"
          },
          "gpsWebView": {
            "type": "string",
            "description": "ดูพิกัด GPS แบบ webView"
          },
          "GeoJSONApi": {
            "type": "string",
            "description": "ข้อมูลเพื่อดึงข้อมูลตำแหน่งในรูปแบบ GeoJSON"
          },
          "createAt": {
            "type": "string",
            "description": "สร้างข้อมูลเมื่อ ไม่ต้องส่งค่านี้เข้ามา จะถูกสร้างโดยระบบ",
            "example": "2023-03-10T22:08:51.718584300"
          }
        }
      },
      "conferenceRoom": {
        "type": "object",
        "description": "ข้อมูลห้องประชุมฉุกเฉิน",
        "properties": {
          "roomId": {
            "type": "string",
            "description": "รหัส id ของห้องประชุมในการสร้งแต่ละครั้ง รหัสนี้จะไม่ซ้ำกัน",
            "example": "c11235"
          },
          "link": {
            "type": "string",
            "description": "ลิงก์หน้าเว็บห้องประชุมเฉุกเฉิน",
            "example": "https://mi-dems-con/c11235"
          },
          "createAt": {
            "type": "string",
            "description": "สร้างข้อมูลเมื่อ ไม่ต้องส่งค่านี้เข้ามา จะถูกสร้างโดยระบบ",
            "example": "2023-03-10T22:08:51.718584300"
          },
          "detail": {
            "type": "object",
            "description": "ข้อมูลรายละเอียดอื่นๆ",
            "properties": {
              "case": {
                "description": "ข้อมูลเกี่ยวกับเคส",
                "$ref": "#/components/schemas/configRoom"
              }
            }
          }
        }
      },
      "reasonCode": {
        "type": "string",
        "description": "รหัสเหตุผล 1=ส่งต่อชุดระดับสูงกว่า, 2=ไม่นำส่ง, 3=เสียชีวิตระหว่างนำส่ง, 4=เสียชีวิต ณ จุดเกิดเหตุ",
        "default": "2",
        "enum": ["1", "2", "3", "4"]
      }
    },
    "responses": {
      "notFound404": {
        "description": "ไม่พบข้อมูล",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 404 code",
                  "type": "string",
                  "example": "404"
                },
                "Message": {
                  "description": "ข้อความสถานะ Not Found",
                  "type": "string",
                  "example": "ไม่พบข้อมูล......"
                }
              }
            }
          }
        }
      },
      "noAuth401": {
        "description": "token ไม่มีสิทธิ์ใช้งานระบบ",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 401 code",
                  "type": "string",
                  "example": "401"
                },
                "Message": {
                  "description": "ข้อความสถานะ Unauthorized",
                  "type": "string",
                  "example": "Unauthorized ......"
                }
              }
            }
          }
        }
      },
      "bad400": {
        "description": "Bad Request เกิดจากพารามิเตอร์บางตัวมีปัญหา",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "MessageCode": {
                  "description": "สถานะ http 400 code",
                  "type": "string",
                  "example": "400"
                },
                "Message": {
                  "description": "ข้อความสถานะ Bad Request",
                  "type": "string",
                  "example": "Bad Request .....ไม่พบ...ค่าเกิน...."
                }
              }
            }
          }
        }
      }
    }
  },
  "paths": {
    "/room/{operation_set_id}": {
      "post": {
        "tags": ["ห้องประชุม"],
        "summary": "สร้างห้องประชุม Mi-DEMS",
        "description": "สร้างห้องประชุมในระบบ Mi-DEMS โดยระบบจะส่งการแจ้งเตือนรับงานฉุกเฉินไปยังทุกคนในชุดที่ระบุ",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "txx1123"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/configRoom"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "ส่งคืนข้อมูลห้องประชุม",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/conferenceRoom"
                }
              }
            }
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "Bad request ดู message",
            "$ref": "#/components/responses/bad400"
          }
        }
      },
      "delete": {
        "tags": ["ห้องประชุม"],
        "summary": "ปิดห้องประชุม Mi-DEMS",
        "description": "ปิดห้องประชุมในระบบ Mi-DEMS โดยระบบจะปิดห้องของชุด และ นำผู้ป่วยที่อยู่ในการดูแลของชุดนี้ออก และพร้อมสำหรับสร้างห้องใหม่ต่อไป",
        "parameters": [
          {
            "name": "operation_set_id",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "txx1123"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reasonCode": {
                    "$ref": "#/components/schemas/reasonCode"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ปิดห้องสมบูรณ์"
          },
          "401": {
            "description": "ไม่มีสิทธิ์ใช้งานระบบ",
            "$ref": "#/components/responses/noAuth401"
          },
          "404": {
            "description": "ไม่พบรหัส operation_set_id",
            "$ref": "#/components/responses/notFound404"
          },
          "400": {
            "description": "ไม่พบรหัส reasonCode ที่ระบุ",
            "$ref": "#/components/responses/bad400"
          }
        }
      }
    },
    "/room/{operation_set_id}/patient": {
      "post": {
        "tags": ["ห้องประชุม", "ผู้ป่วย", "TODO รอออกแบบ"],
        "summary": "เพิ่มผู้ป่วยในห้อง",
        "description": "ใช้ในกรณี มีผู้ป่วยเพิ่มหลังจากสร้างห้องไปแล้ว"
      }
    },
    "/patient/{patientId}": {
      "get": {
        "tags": ["ผู้ป่วย", "TODO รอออกแบบ"],
        "summary": "ข้อมูลผู้ป่วย",
        "description": "ดูข้อมูลที่มีการเชื่อมโยงกับเคส เช่น ข้อมูลชุดที่รับพวกลิงก์ข้อมูลต่างๆ",
        "parameters": [
          {
            "name": "patientId",
            "description": "รหัสชุดที่ออกปฏิบัติการ",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "default": "p1123"
            }
          }
        ]
      }
    }
  }
}
